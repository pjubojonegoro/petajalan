
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- leaflet css link  -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"/>
	<link rel="stylesheet" href="leaflet-search.css" />
	<link rel="stylesheet" href="leaflet-panel-layers.css" />
	<!-- Mapbox GL -->
    <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v1.2.0/mapbox-gl.css" rel='stylesheet' />
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v1.2.0/mapbox-gl.js"></script>
    <script src="https://unpkg.com/rbush@3.0.1/rbush.js"></script>

    <title>Peta Sebaran PJU Kab Bojonegoro</title>

    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #map {
        width: 100%;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>


<!-- leaflet js link  -->

<script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>
<script src="https://rawgit.com/mapbox/mapbox-gl-leaflet/master/leaflet-mapbox-gl.js"></script>
    <script src="leaflet-markers-canvas.js"></script>
<!-- js data link  -->
<script src="data/lampujalankab.js"></script>
<script src="data/lampujalankota.js"></script>
<script src="data/titiklampurencanaapbd2021.js"></script>
<script src="data/ruaskab.js"></script>
<script src="data/ruaskota.js"></script>
<script src="data/kwh.js"></script>
<script src="leaflet-search.js"></script>
<script src="leaflet-panel-layers.js"></script>
<script src="titikbaru.js"></script>

<script>
	var map = L.map('map', {
			zoom: 14,
			center: new L.latLng(-7.162553317686097, 111.87944412231445),
		}),
		geojsonOpts = {
			pointToLayer: function(feature, latlng) {
				return L.marker(latlng, {
					icon: L.divIcon({
						className: feature.properties.wilayah,
						iconSize: L.point(16, 16),
						html: feature.properties.wilayah[0].toUpperCase(),
					})
				}).bindPopup(feature.properties.wilayah+'<br><b>'+feature.properties.ruas+'</b>');
			}
		};

	var gldark = new L.mapboxGL({
    accessToken: 'pk.eyJ1IjoiZGhhbWFyYXIiLCJhIjoiY2wzbndleGM0MGhlejNjcGV5Z2V0a2E5dyJ9.MgJI6ePjYJ6ihnHL_nOYaA',
    style: 'mapbox://styles/mapbox/dark-v10',
	preferCanvas: true
	});
	map.addLayer(gldark);
	      var markersCanvas = new L.MarkersCanvas();

      markersCanvas.addTo(map);
	  //////////////////////// TITIK LAMPU PJU ////////////////////////////////
	var icon = L.icon({
        iconUrl: "lampu.png",
        iconSize: [8, 8],
        iconAnchor: [0, 0],
      });
	  var merah = L.icon({
        iconUrl: "baru.png",
        iconSize: [8, 8],
        iconAnchor: [0, 0],
      });
	  
	 var markers = [];
	 
      for (var i = 0; i < lampujalan.length; i++) {
  marker = new L.marker([lampujalan[i][1], lampujalan[i][2]], {icon})
    .bindPopup(lampujalan[i][0])
	markers.push(marker);
	}


	  
	 for (var i = 0; i < rencana2021.length; i++) {
  markerbaru = new L.marker([rencana2021[i][1], rencana2021[i][0]], {icon: merah})
    .addTo(map);
}
      markersCanvas.addMarkers(markers);
	//////////////////////// TITIK LAMPU PJU ////////////////////////////////
	
	//////////////////////// PENCARIAN RUAS JALAN ////////////////////////////////
	var poiLayers = L.layerGroup([
		L.geoJson(ruaskab, geojsonOpts),
		L.geoJson(ruaskota, geojsonOpts)
	])
	.addTo(map);

	L.control.search({
		layer: poiLayers,
		initial: false,
		propertyName: 'ruas',
		buildTip: function(text, val) {
			var nomor = val.layer.feature.properties.nomor;
			return '<a href="#" class="'+nomor+'">'+nomor+'.'+text+'</a>';
		}
	})
	.addTo(map);  
	//////////////////////// PENCARIAN RUAS JALAN ////////////////////////////////
	
	//////////////////////// RUAS JALAN ////////////////////////////////
	var myStyle = {
    "weight": 4,
	};
	function onEachFeature(feature, layer) {
		if (feature.properties && feature.properties.wilayah) {
		layer.bindPopup(feature.properties.nomor+'. '+feature.properties.ruas);
		}
		}

	var ruasKab = L.geoJSON(ruaskab, {
		style: myStyle,
		filter: function (feature, layer) {
			return true;
		},

		onEachFeature: onEachFeature
	}).addTo(map);
	
	var ruasKota = L.geoJSON(ruaskota, {
		style: myStyle,
		filter: function (feature, layer) {
			return true;
		},

		onEachFeature: onEachFeature
	}).addTo(map);
	//////////////////////// RUAS JALAN ////////////////////////////////
	
	
	//////////////////////// LOKASI ////////////////////////////////
		function onLocationFound(e) {
		var radius = e.accuracy;

		var locationMarker = L.marker(e.latlng).addTo(map)
		var locationCircle = L.circle(e.latlng, radius).addTo(map);
	}

	function onLocationError(e) {
		alert(e.message);
	}

	map.on('locationfound', onLocationFound);
	map.on('locationerror', onLocationError);

	map.locate({setView: true, maxZoom: 16});
	//////////////////////// LOKASI ////////////////////////////////
	
	////////////////////////////////////////////////////////////////
	var baseLayers = [
	{
		name: "Dark",
		layer: gldark
	},
	{
		name: "Light",
		layer: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
	},
	{
		name: "Satellite",
		layer: L.mapboxGL({accessToken: 'pk.eyJ1IjoiZGhhbWFyYXIiLCJhIjoiY2wzbndleGM0MGhlejNjcGV5Z2V0a2E5dyJ9.MgJI6ePjYJ6ihnHL_nOYaA',
		style: 'mapbox://styles/mapbox/satellite-v9'})
	}
	];

	var overLayers = [
	{
		name: "APP",
		layer: L.geoJSON(kwh)
	}];

	var panelLayers = new L.Control.PanelLayers(baseLayers, overLayers);
	map.addControl(panelLayers);
	
	function onLocationFound(e) {
  var radius = e.accuracy;
  L.marker(e.latlng).addTo(map)
}

map.on('locationfound', onLocationFound);
map.locate({setView: true, watch: true, maxZoom: 14});
</script>
  </body>
</html>